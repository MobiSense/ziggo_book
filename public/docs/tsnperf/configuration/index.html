<!DOCTYPE html>
<html lang="en" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="TSNPerf 硬件准备 系统准备 和 测试程序使用">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/tsnperf/configuration/">
  <meta property="og:site_name" content="ZIGGO BOOK">
  <meta property="og:title" content="TSNPerf User Guide">
  <meta property="og:description" content="TSNPerf 硬件准备 系统准备 和 测试程序使用">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2024-05-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-05-01T00:00:00+00:00">
    <meta property="article:tag" content="TSNPerf">
    <meta property="article:tag" content="ZIGGO">
    <meta property="article:tag" content="Markdown">
    <meta property="og:image" content="http://localhost:1313/docs/tsnperf/configuration/featured.jpg">
<title>TSNPerf User Guide | ZIGGO BOOK</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="canonical" href="http://localhost:1313/docs/tsnperf/configuration/">
  <link rel="alternate" hreflang="zh" href="http://localhost:1313/zh/docs/tsnperf/configuration/" title="TSNPerf 使用指南">
<link rel="stylesheet" href="/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css" integrity="sha256-MJt&#43;0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.880afd6a6348ab60e7c50e6108464ff34c45db0bc79bb5f304f9cbda917a04c1.js" integrity="sha256-iAr9amNIq2DnxQ5hCEZP80xF2wvHm7XzBPnL2pF6BME=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>ZIGGO BOOK</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>



  



  
    
  


  


<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </label>

    <ul>
      
      <li>
        <a href="http://localhost:1313/zh/docs/tsnperf/configuration/">
          Chinese
        </a>
      </li>
      
    </ul>
  </li>
</ul>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f7037f1d8c98cfd6af893e54a7a7c84a" class="toggle" checked />
    <label for="section-f7037f1d8c98cfd6af893e54a7a7c84a" class="flex justify-between">
      <a href="/docs/tsnperf/" class="">ZIGGO TSNPerf</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/tsnperf/principle/" class="">TSNPerf Design Principles</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tsnperf/configuration/" class="active">TSNPerf User Guide</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tsnperf/manual/" class="">TSNPerf Test Content and Usage Table</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tsnperf/report/" class="">Report for Brand A Switch</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d43c4f20a039dd2c08c63c6629ffaedf" class="toggle"  />
    <label for="section-d43c4f20a039dd2c08c63c6629ffaedf" class="flex justify-between">
      <a href="/docs/switch/" class="">ZIGGO Switch</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/switch/basic_knowledge/" class="">List of Basic Knowledge</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/switch/require/" class="">Preparation Checklist</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/switch/system-design/" class="">System Design</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/switch/hardware-build/" class="">Hardware Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/switch/software-build/" class="">Software Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/switch/contributing/" class="">How to contribute</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9944d1fadd4ce8adc7644b141d205c6b" class="toggle"  />
    <label for="section-9944d1fadd4ce8adc7644b141d205c6b" class="flex justify-between">
      <a href="/docs/device/" class="">ZIGGO Device</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/device/basic_knowledge/" class="">List of Basic Knowledge</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/device/require/" class="">Preparation Checklist</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/device/getting-started/" class="">Getting start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/device/system-design/" class="">System Design</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/device/hardware-build/" class="">Hardware Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/device/software-build/" class="">Software Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/device/ziggo_device_manual/" class="">ZIGGO Device Manual</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/device/cnc_manual/" class="">CNC Script Usage Guide</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/device/testbed/" class="">TestBed Setup Process</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/device/contributing/" class="">How to contribute</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>TSNPerf User Guide</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <div style="margin-top:10px; margin-bottom:40px; display:flex; justify-content:center; gap: 25px;">
    <a href="https://github.com/MobiSense/ziggo_book" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">GitHub</a>
    <a href="https://mobisense.github.io/ziggo_homepage/" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">Home</a>
</div>

<nav id="TableOfContents">
  <ul>
    <li><a href="#hardware-preparation">Hardware Preparation</a></li>
    <li><a href="#system-preparation">System Preparation</a></li>
    <li><a href="#enable-time-synchronization">Enable Time Synchronization</a>
      <ul>
        <li><a href="#installing-linuxptp">Installing linuxPTP</a></li>
        <li><a href="#synchronize-the-clocks-of-publisher-and-recorders-network-cards">Synchronize the Clocks of Publisher and Recorder&rsquo;s Network Cards</a></li>
        <li><a href="#synchronize-network-card-clocks-with-the-system-clock">Synchronize Network Card Clocks with the System Clock</a></li>
      </ul>
    </li>
    <li><a href="#optimize-the-network-stack">Optimize the Network Stack</a>
      <ul>
        <li><a href="#bind-critical-traffic-to-queue-0">Bind Critical Traffic to Queue 0</a></li>
        <li><a href="#bind-queue-0-interrupts-to-isolated-cores-and-set-priority">Bind Queue 0 Interrupts to Isolated Cores and Set Priority</a></li>
        <li><a href="#enable-launchtime-feature">Enable LaunchTime Feature</a></li>
      </ul>
    </li>
    <li><a href="#modify-configuration-files">Modify Configuration Files</a></li>
    <li><a href="#launch-the-receiving-program-on-the-publisher">Launch the Receiving Program on the Publisher</a></li>
    <li><a href="#launch-the-sending-program-on-the-recorder">Launch the Sending Program on the Recorder</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="tsnperf-user-guide">
  TSNPerf User Guide
  <a class="anchor" href="#tsnperf-user-guide">#</a>
</h1>
<h2 id="hardware-preparation">
  Hardware Preparation
  <a class="anchor" href="#hardware-preparation">#</a>
</h2>
<p>Prepare two machines, one as the sender (Publisher) and the other as the receiver (Recorder), each equipped with the following hardware requirements:</p>
<ul>
<li>Intel processor, 8th generation or above</li>
<li>Intel I210 / I225-LM / I225-LM network cards</li>
</ul>
<p><strong>Note</strong>: The Publisher should have two network cards installed—one for time synchronization and the other for sending packets. The Recorder only needs one network card, which will handle both time synchronization and data reception.</p>
<h2 id="system-preparation">
  System Preparation
  <a class="anchor" href="#system-preparation">#</a>
</h2>
<p>Install the following systems and software dependencies on both the sender and receiver machines:</p>
<ul>
<li>Install Ubuntu 22.04</li>
<li>Install Intel ECI: <a href="https://eci.intel.com/docs/3.1/getstarted/requirements.html">https://eci.intel.com/docs/3.1/getstarted/requirements.html</a></li>
<li>Install linuxPTP, see the next section</li>
<li>Install dependencies:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo apt-get install libconfig-dev libpcap-dev
</span></span></code></pre></div><p>Before starting the experiment, ensure that the devices to be tested are properly connected to the Publisher and Recorder and that the machines are powered on.</p>
<h2 id="enable-time-synchronization">
  Enable Time Synchronization
  <a class="anchor" href="#enable-time-synchronization">#</a>
</h2>
<h3 id="installing-linuxptp">
  Installing linuxPTP
  <a class="anchor" href="#installing-linuxptp">#</a>
</h3>
<h4 id="1-install-the-network-card-driver">
  1. Install the Network Card Driver
  <a class="anchor" href="#1-install-the-network-card-driver">#</a>
</h4>
<p>Download the driver from <a href="https://www.intel.com/content/www/us/en/download/14098/intel-network-adapter-driver-for-82575-6-82580-i350-and-i210-211-based-gigabit-network-connections-for-linux.html">Intel&rsquo;s website</a> and follow the tutorial in the README file to compile and install the driver.</p>
<p>Use the following command to check the installation (<code>enp3s0</code> is the network card name). If installed correctly, you should see the output highlighted in the red box below (indicating that the network card has hardware timestamp capabilities):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ethtool -T enp3s0
</span></span></code></pre></div><p><img src="./configuration_linuxptp_check.jpg" alt="" title="linuxPTP Installation Check"/></p>
<h4 id="2-install-linuxptp">
  2. Install linuxPTP
  <a class="anchor" href="#2-install-linuxptp">#</a>
</h4>
<p>Install linuxPTP with the following commands:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git clone http://git.code.sf.net/p/linuxptp/code linuxptp
</span></span><span style="display:flex;"><span>cd linuxptp/
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>sudo make install
</span></span></code></pre></div><h3 id="synchronize-the-clocks-of-publisher-and-recorders-network-cards">
  Synchronize the Clocks of Publisher and Recorder&rsquo;s Network Cards
  <a class="anchor" href="#synchronize-the-clocks-of-publisher-and-recorders-network-cards">#</a>
</h3>
<p>Use the following command to start time synchronization on the network cards of both the Publisher and Recorder. Replace <code>enp3s0</code> with your network card name and <code>&lt;configuration&gt;.cfg</code> with a configuration file based on the examples in <code>linuxptp/configs/</code> and customized to your requirements.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo ptp4l -i enp3s0 -f &lt;configuration&gt;.cfg -m -l <span style="color:#ae81ff">6</span> --socket_priority <span style="color:#ae81ff">7</span>
</span></span></code></pre></div><p><strong>Note</strong>: If necessary, also start the time synchronization function on the device under test.</p>
<h3 id="synchronize-network-card-clocks-with-the-system-clock">
  Synchronize Network Card Clocks with the System Clock
  <a class="anchor" href="#synchronize-network-card-clocks-with-the-system-clock">#</a>
</h3>
<p>After synchronizing the network cards of the Publisher and Recorder, synchronize their clocks with the system clock as well.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo phc2sys -c CLOCK_REALTIME -s enp3s0 -O -0 -m -l <span style="color:#ae81ff">6</span>
</span></span></code></pre></div><p>Since the Publisher uses separate network cards for time synchronization and packet sending, synchronize the sending network card&rsquo;s clock with the system as well:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo phc2sys -s CLOCK_REALTIME -c enp1s0 -O -0 -m -l <span style="color:#ae81ff">6</span>
</span></span></code></pre></div><h2 id="optimize-the-network-stack">
  Optimize the Network Stack
  <a class="anchor" href="#optimize-the-network-stack">#</a>
</h2>
<h3 id="bind-critical-traffic-to-queue-0">
  Bind Critical Traffic to Queue 0
  <a class="anchor" href="#bind-critical-traffic-to-queue-0">#</a>
</h3>
<p>Execute the following commands on both the Publisher and Recorder to bind critical traffic to Queue 0.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo ethtool --config-ntuple enp1s0 delete <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>sudo ethtool --config-ntuple enp1s0 flow-type ether proto 0xb62c loc <span style="color:#ae81ff">15</span> action <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>sudo ethtool -X enp1s0 equal <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><p><strong>Note</strong>:</p>
<ol>
<li><code>enp1s0</code> represents the network card on the Publisher responsible for sending packets or the network card on the Recorder.</li>
<li>The <code>0xb62c</code> in the second line is the ethertype for critical traffic; ensure it matches the <code>ethertype</code> specified in the next section.</li>
</ol>
<h3 id="bind-queue-0-interrupts-to-isolated-cores-and-set-priority">
  Bind Queue 0 Interrupts to Isolated Cores and Set Priority
  <a class="anchor" href="#bind-queue-0-interrupts-to-isolated-cores-and-set-priority">#</a>
</h3>
<p>Execute the following commands on both the Publisher and Recorder.</p>
<p><strong>Bind to Isolated Cores</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cat /proc/interrupts | grep TxRx-0
</span></span></code></pre></div><p><img src="./configuration_stack_irqaffi.jpg" alt="Interrupt Binding to Isolated Core" title="Interrupt Binding to Isolated Core"/></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo sh -c <span style="color:#e6db74">&#34;echo 2 &gt; /proc/irq/131/smp_affinity&#34;</span>
</span></span></code></pre></div><p><strong>Set Priority</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ps -ae | grep <span style="color:#ae81ff">131</span>
</span></span></code></pre></div><p><img src="./configuration_stack_irpri.jpg" alt="" title="Setting Interrupt Priority"/></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo chrt -fp <span style="color:#ae81ff">95</span> 
</span></span></code></pre></div><h3 id="enable-launchtime-feature">
  Enable LaunchTime Feature
  <a class="anchor" href="#enable-launchtime-feature">#</a>
</h3>
<p>Enable the LaunchTime feature on</p>
<p>the Publisher:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo tc qdisc add dev enp1s0 handle 8001: parent root mqprio num_tc <span style="color:#ae81ff">4</span> map <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> queues 1@0 1@1 1@2 1@3 hw <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>sudo tc qdisc replace dev enp1s0 parent 8001:1 etf offload clockid CLOCK_TAI delta <span style="color:#ae81ff">500000</span>
</span></span></code></pre></div><h2 id="modify-configuration-files">
  Modify Configuration Files
  <a class="anchor" href="#modify-configuration-files">#</a>
</h2>
<p>Modify the configuration file according to your testing needs. Here is an example configuration <code>default.ini</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mode:                   <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>tx-mode:                <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>verbose:                true
</span></span><span style="display:flex;"><span>use-ziggo-analysis:     false
</span></span><span style="display:flex;"><span>pcap-filename:          <span style="color:#e6db74">&#34;/home/i210/launchtimedemo/captured_10w_1500Byte.pcap&#34;</span>
</span></span><span style="display:flex;"><span>interface:              <span style="color:#e6db74">&#34;enp1s0&#34;</span>
</span></span><span style="display:flex;"><span>smac:                   <span style="color:#e6db74">&#34;00:1b:21:77:ac:ae&#34;</span>
</span></span><span style="display:flex;"><span>dmac:                   <span style="color:#e6db74">&#34;00:1b:21:76:ae:75&#34;</span>
</span></span><span style="display:flex;"><span>ethertype:              0xb62c
</span></span><span style="display:flex;"><span>socket-priority:        <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>vlan-priority:          <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>offset:                 <span style="color:#ae81ff">150000</span>
</span></span><span style="display:flex;"><span>early-offset:           <span style="color:#ae81ff">300000</span>
</span></span><span style="display:flex;"><span>use-launchtime:         true
</span></span><span style="display:flex;"><span>basetime:               1684559640000000100L
</span></span><span style="display:flex;"><span>packet-size:            <span style="color:#ae81ff">1500</span>
</span></span><span style="display:flex;"><span>packets-to-send:        <span style="color:#ae81ff">100000</span>
</span></span><span style="display:flex;"><span>interval:               <span style="color:#ae81ff">1000000</span>
</span></span><span style="display:flex;"><span>use-udp:                true
</span></span><span style="display:flex;"><span>sip:                    <span style="color:#e6db74">&#34;192.168.16.10&#34;</span>
</span></span><span style="display:flex;"><span>dip:                    <span style="color:#e6db74">&#34;192.168.16.11&#34;</span>
</span></span><span style="display:flex;"><span>sport:                  <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>dport:                  <span style="color:#ae81ff">10000</span>
</span></span></code></pre></div><h2 id="launch-the-receiving-program-on-the-publisher">
  Launch the Receiving Program on the Publisher
  <a class="anchor" href="#launch-the-receiving-program-on-the-publisher">#</a>
</h2>
<p>The receiving program can use Intel&rsquo;s <a href="https://github.com/intel/iotg_tsn_ref_sw">txrx-tsn</a> in reception mode, paired with <code>use-ziggo-analysis = false</code>, to directly obtain the packet&rsquo;s sending and receiving timestamps. However, conflicts with iperf during background traffic tests have been observed. Consider using tcpdump to capture packets and save high-precision rx timestamps. Tx timestamps can be obtained from the sender&rsquo;s program output for analysis.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo tcpdump -i &lt;network interface&gt; ether proto 0xb62c -j adapter_unsynced --time-stamp-precision<span style="color:#f92672">=</span>nano -s <span style="color:#ae81ff">0</span> -tttt -w &lt;path to save pcap file&gt;
</span></span></code></pre></div><h2 id="launch-the-sending-program-on-the-recorder">
  Launch the Sending Program on the Recorder
  <a class="anchor" href="#launch-the-sending-program-on-the-recorder">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /path/to/launchtimedemo
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>sudo taskset -c <span style="color:#ae81ff">1</span> chrt -f <span style="color:#ae81ff">92</span> ./pcap_replay -c ~/launchtimedemo/config.ini
</span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">




  <div>
    <a class="flex align-center" href="https://github.com/Mobisense/ziggo_book///tree/main//content/docs/tsnperf/configuration/index.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        <footer id="mu-footer" role="contentinfo" style="	height: 160px;
clear: both;
color: #000000;
text-align: center;
padding-top: 100px;">
    <div class="container">
        <div class="col-sm-12">
            <div>
                <p> Room 211, District 11, East Main Building, Tsinghua University, Haidian District, Beijing, China, 100084 | </p>
                <p> &copy 2021 <span class="ziggo-font">ZIGGO</span>, TNS, School of Software, Tsinghua University . All rights reserved. </p>
            </div>
        </div>
    </div>
</footer>
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  <div style="margin-top:10px; margin-bottom:40px; display:flex; justify-content:center; gap: 25px;">
    <a href="https://github.com/MobiSense/ziggo_book" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">GitHub</a>
    <a href="https://mobisense.github.io/ziggo_homepage/" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">Home</a>
</div>

<nav id="TableOfContents">
  <ul>
    <li><a href="#hardware-preparation">Hardware Preparation</a></li>
    <li><a href="#system-preparation">System Preparation</a></li>
    <li><a href="#enable-time-synchronization">Enable Time Synchronization</a>
      <ul>
        <li><a href="#installing-linuxptp">Installing linuxPTP</a></li>
        <li><a href="#synchronize-the-clocks-of-publisher-and-recorders-network-cards">Synchronize the Clocks of Publisher and Recorder&rsquo;s Network Cards</a></li>
        <li><a href="#synchronize-network-card-clocks-with-the-system-clock">Synchronize Network Card Clocks with the System Clock</a></li>
      </ul>
    </li>
    <li><a href="#optimize-the-network-stack">Optimize the Network Stack</a>
      <ul>
        <li><a href="#bind-critical-traffic-to-queue-0">Bind Critical Traffic to Queue 0</a></li>
        <li><a href="#bind-queue-0-interrupts-to-isolated-cores-and-set-priority">Bind Queue 0 Interrupts to Isolated Cores and Set Priority</a></li>
        <li><a href="#enable-launchtime-feature">Enable LaunchTime Feature</a></li>
      </ul>
    </li>
    <li><a href="#modify-configuration-files">Modify Configuration Files</a></li>
    <li><a href="#launch-the-receiving-program-on-the-publisher">Launch the Receiving Program on the Publisher</a></li>
    <li><a href="#launch-the-sending-program-on-the-recorder">Launch the Sending Program on the Recorder</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












