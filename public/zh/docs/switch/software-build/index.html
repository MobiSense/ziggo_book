<!DOCTYPE html>
<html lang="zh" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Docs to enable CaaS Switches&rsquo; time synchronization logic and set up TSN GCL (gate control list), switch forwarding rules (including to dual-DMA).">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/zh/docs/switch/software-build/">
  <meta property="og:site_name" content="ZIGGO BOOK">
  <meta property="og:title" content="Software Build">
  <meta property="og:description" content="Docs to enable CaaS Switches’ time synchronization logic and set up TSN GCL (gate control list), switch forwarding rules (including to dual-DMA).">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2024-05-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-05-01T00:00:00+00:00">
    <meta property="article:tag" content="ZIGGO-SWITCH">
    <meta property="article:tag" content="ZIGGO">
    <meta property="article:tag" content="Markdown">
    <meta property="og:image" content="http://localhost:1313/zh/docs/switch/software-build/featured.jpg">
<title>Software Build | ZIGGO BOOK</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="canonical" href="http://localhost:1313/zh/docs/switch/software-build/">
  <link rel="alternate" hreflang="en" href="http://localhost:1313/docs/switch/software-build/" title="Software Build">
<link rel="stylesheet" href="/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css" integrity="sha256-MJt&#43;0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/zh.search.min.0a35798c78c016e2b218365660d9a17cabc3941c772e735cffb8ebd0a1bcbd84.js" integrity="sha256-CjV5jHjAFuKyGDZWYNmhfKvDlBx3LnNc/7jr0KG8vYQ=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/zh/"><img src="/logo.png" alt="Logo" /><span>ZIGGO BOOK</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="搜索" aria-label="搜索" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>



  



  
    
  


  


<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        Chinese
      </a>
    </label>

    <ul>
      
      <li>
        <a href="http://localhost:1313/docs/switch/software-build/">
          English
        </a>
      </li>
      
    </ul>
  </li>
</ul>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f7037f1d8c98cfd6af893e54a7a7c84a" class="toggle"  />
    <label for="section-f7037f1d8c98cfd6af893e54a7a7c84a" class="flex justify-between">
      <a href="/zh/docs/tsnperf/" class="">ZIGGO TSNPerf</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/tsnperf/principle/" class="">TSNPerf 设计原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/tsnperf/configuration/" class="">TSNPerf 使用指南</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/tsnperf/manual/" class="">TSNPerf 检测内容及使用表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/tsnperf/report/" class="">某品牌交换机报告</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d43c4f20a039dd2c08c63c6629ffaedf" class="toggle" checked />
    <label for="section-d43c4f20a039dd2c08c63c6629ffaedf" class="flex justify-between">
      <a href="/zh/docs/switch/" class="">ZIGGO Switch</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/basic_knowledge/" class="">基础知识列表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/require/" class="">准备清单</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/system-design/" class="">System Design</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/hardware-build/" class="">Hardware Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/software-build/" class="active">Software Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/contributing/" class="">How to contribute</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9944d1fadd4ce8adc7644b141d205c6b" class="toggle"  />
    <label for="section-9944d1fadd4ce8adc7644b141d205c6b" class="flex justify-between">
      <a href="/zh/docs/device/" class="">ZIGGO Device</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/basic_knowledge/" class="">基础知识列表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/require/" class="">准备清单</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/getting-started/" class="">Getting start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/system-design/" class="">System Design</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/hardware-build/" class="">Hardware Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/software-build/" class="">Software Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/ziggo_device_manual/" class="">ZIGGO Device使用手册</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/cnc_manual/" class="">CNC脚本使用指南</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/testbed/" class="">TestBed搭建流程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/contributing/" class="">How to contribute</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Software Build</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <div style="margin: 50px; display:flex; justify-content:center; gap: 25px;">
    <a href="https://github.com/MobiSense/ziggo_book" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">GitHub</a>
    <a href="https://mobisense.github.io/ziggo_homepage/" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">Home</a>
</div>

<nav id="TableOfContents">
  <ul>
    <li><a href="#build">Build</a></li>
    <li><a href="#config">Config</a></li>
    <li><a href="#run">Run</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="software-build">
  Software Build
  <a class="anchor" href="#software-build">#</a>
</h1>
<p>This repo contains source code to enable CaaS Switches&rsquo; time synchronization logic and set up TSN GCL (gate control list), switch forwarding rules (including to dual-DMA).</p>
<h2 id="build">
  Build
  <a class="anchor" href="#build">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir build
</span></span><span style="display:flex;"><span>cd build
</span></span><span style="display:flex;"><span>cmake ..
</span></span><span style="display:flex;"><span>make
</span></span></code></pre></div><p>After successfully build, there should be two executables: &ldquo;time_sync_app&rdquo; &amp; &ldquo;switch_config&rdquo;</p>
<h2 id="config">
  Config
  <a class="anchor" href="#config">#</a>
</h2>
<p>The &ldquo;config&rdquo; directory contains topology &amp; TSN/CaaS schedule results.</p>
<p>This document takes the following topology as an example to give example configurations:</p>
<p><img src="./example_topology.png" alt="topology" /></p>
<ul>
<li>
<p>***-config.json: Mainly describes the network&rsquo;s topology, including the type of each node (device or switch), MAC address, PTP port status, and other node information, topology information, and MAC forwarding table. Example and explanation are as follows (note that the comments in the file are just for explanation, do not have such comments in actual use):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;nodes&#34;</span>: [ <span style="color:#75715e">// Used to describe the information of each node in the network
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">10</span>, <span style="color:#75715e">// Node ID, corresponding to &#34;src&#34; and &#34;dst&#34; below
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;switch&#34;</span>, <span style="color:#75715e">// Node type, divided into &#34;switch&#34; and &#34;device&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;mac&#34;</span>: <span style="color:#e6db74">&#34;00:0a:35:00:00:10&#34;</span>, <span style="color:#75715e">// Node&#39;s physical MAC address
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;ptp_ports&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>            ] <span style="color:#75715e">// Node&#39;s PTP port status
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">// The quintuple represents the clock status of [local, ETH1, ETH2, ETH3, ETH4]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">// Number meaning: (0: MASTER, 1: SLAVE, 2: PASSIVE, 3: DISABLED)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">// If local is 1, it means that the node is the master clock node;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">// If local is 0, it means that the node is the slave clock node.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">14</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;device&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;mac&#34;</span>: <span style="color:#e6db74">&#34;00:0a:35:00:00:14&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;device&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;mac&#34;</span>: <span style="color:#e6db74">&#34;00:0a:35:00:00:15&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;links&#34;</span>: [  <span style="color:#75715e">// Topology information, composed of each link, each link is a directed edge
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#75715e">// link ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;src&#34;</span>: <span style="color:#ae81ff">14</span>, <span style="color:#75715e">// Source node ID of the link
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;src_port&#34;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#75715e">// Port number of the source node
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                           <span style="color:#75715e">// port 0,1,2,3 correspond to ETH1,2,3,4 in reality
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;dst&#34;</span>: <span style="color:#ae81ff">10</span>, <span style="color:#75715e">// Destination node ID of the link
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;dst_port&#34;</span>: <span style="color:#ae81ff">0</span> <span style="color:#75715e">// Port number of the destination node
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src_port&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dst&#34;</span>: <span style="color:#ae81ff">14</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dst_port&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src_port&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dst&#34;</span>: <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dst_port&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src&#34;</span>: <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src_port&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dst&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dst_port&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;fwd&#34;</span>: [ <span style="color:#75715e">// Forwarding table, which can be generated by the scheduling algorithm in CNC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// In the forwarding table where you send to yourself, the port is 4 (caas) / 5 (PS ETH for new hardware)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src&#34;</span>: <span style="color:#ae81ff">10</span>, <span style="color:#75715e">// Current node ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;dst&#34;</span>: <span style="color:#ae81ff">14</span>, <span style="color:#75715e">// Output port number
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#75715e">// Entry ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;src_port&#34;</span>: <span style="color:#ae81ff">0</span> <span style="color:#75715e">// Destination node ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src&#34;</span>: <span style="color:#ae81ff">14</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dst&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src_port&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dst&#34;</span>: <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src_port&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src&#34;</span>: <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;dst&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;src_port&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>If the master clock selection algorithm is used, only the configuration of nodes is different, and the rest are the same. The newly added <code>externalPortConfigurationEnabled</code> and <code>system_identity</code> fields are optional items, as shown in the example below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;nodes&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;switch&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;mac&#34;</span>: <span style="color:#e6db74">&#34;00:00:00:00:02:01&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;ptp_ports&#34;</span>: [<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>], 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;externalPortConfigurationEnabled&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#75715e">// 1: Manually configure the master-slave relationship, 0: Configure the master-slave relationship through the master clock selection algorithm, if this item is not written, the default is 0, that is, configure the master-slave relationship through the master clock selection
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">&#34;system_identity&#34;</span>: { <span style="color:#75715e">// Clock node&#39;s clock parameters, used for comparison in the master clock selection algorithm, if this item is not written, the default is the configuration written below
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">&#34;priority1&#34;</span>: <span style="color:#ae81ff">254</span>, <span style="color:#75715e">// First priority
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">&#34;clockClass&#34;</span>: <span style="color:#ae81ff">248</span>, <span style="color:#75715e">// Clock level
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">&#34;clockAccuracy&#34;</span>: <span style="color:#ae81ff">254</span>, <span style="color:#75715e">// Clock accuracy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">&#34;offsetScaledLogVariance&#34;</span>: <span style="color:#ae81ff">17258</span>, <span style="color:#75715e">// Clock variance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">&#34;priority2&#34;</span>: <span style="color:#ae81ff">247</span>, <span style="color:#75715e">// Second priority
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">&#34;clock_identity&#34;</span>: [<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>] <span style="color:#75715e">// Clock identifier, different clocks should have different parameters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;links&#34;</span>: [
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;fwd&#34;</span>: [
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p>***-schedule.json: schedule file, contains each links&rsquo; schedule time interval &amp; each CaaS switch&rsquo;s computation time interval.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {<span style="color:#75715e">// All switches need to be listed to facilitate software recognition of configuration information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;switch&#34;</span>,  <span style="color:#75715e">// Node type, divided into &#34;switch&#34; and &#34;device&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">10</span>, <span style="color:#75715e">// Node ID, corresponding to &#34;src&#34; and &#34;dst&#34; below
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;mac&#34;</span>: <span style="color:#e6db74">&#34;00:0a:35:00:00:10&#34;</span>, <span style="color:#75715e">// Node&#39;s physical MAC address
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;schedule&#34;</span>: [
</span></span><span style="display:flex;"><span>        ] <span style="color:#75715e">// Can be empty, not used
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;link&#34;</span>, <span style="color:#75715e">// Type is link, used to describe scheduling information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;from&#34;</span>: <span style="color:#ae81ff">14</span>, <span style="color:#75715e">// Source node ID of the link
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;to&#34;</span>: <span style="color:#ae81ff">10</span>, <span style="color:#75715e">// Destination node ID of the link
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;from_port&#34;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#75715e">// Output port number
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">3</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;schedule&#34;</span>: [ <span style="color:#75715e">// Scheduling information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;period&#34;</span>: <span style="color:#ae81ff">2048</span>, <span style="color:#75715e">// Scheduling cycle
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#75715e">// Start time relative to the entire cycle
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#ae81ff">5</span>, <span style="color:#75715e">// End time relative to the entire cycle
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">&#34;job_id&#34;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#75715e">// Job ID in CaaS, if not needed, it can be omitted
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">&#34;flow_id&#34;</span>: <span style="color:#ae81ff">0</span> <span style="color:#75715e">// Data stream ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;link&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;from&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;to&#34;</span>: <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;from_port&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;schedule&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;period&#34;</span>: <span style="color:#ae81ff">2048</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;start&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#ae81ff">6</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;job_id&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;flow_id&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;pkt_size&#34;</span>: <span style="color:#ae81ff">1500</span> <span style="color:#75715e">// Packet length, if not written, the default is 1500B, this item only exists on the path from Device to Switch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div></li>
</ul>
<h2 id="run">
  Run
  <a class="anchor" href="#run">#</a>
</h2>
<ul>
<li>Copy topology &amp; schedule file to build dir:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cp <span style="color:#f92672">[</span>topology name<span style="color:#f92672">]</span>-config.json build/config.json
</span></span><span style="display:flex;"><span>cp <span style="color:#f92672">[</span>topology name<span style="color:#f92672">]</span>-schedule.json build/schedule.json
</span></span></code></pre></div><ul>
<li>Start time synchronization and initialize GCL and MAC forwarding table according to the configuration (it is recommended to run the time synchronization program on a core (with <code>taskset -c 1</code> command) to prevent kernel errors and crashes due to time synchronization):</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>taskset -c <span style="color:#ae81ff">1</span> ./time_sync
</span></span></code></pre></div><ul>
<li>The log output level is categorized into three types: WARN, INFO, and TRACE. The default log output level is TRACE (the most comprehensive output information, including DEBUG logs).    The log output level can be set with the -l parameter:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>taskset -c <span style="color:#ae81ff">1</span> ./time_sync -l w <span style="color:#75715e"># WARN level</span>
</span></span><span style="display:flex;"><span>taskset -c <span style="color:#ae81ff">1</span> ./time_sync -l i <span style="color:#75715e"># INFO level</span>
</span></span><span style="display:flex;"><span>taskset -c <span style="color:#ae81ff">1</span> ./time_sync -l t <span style="color:#75715e"># TRACE level</span>
</span></span></code></pre></div><p><em>Notice that the time sync logic is supposed to run indefinitely as the node should sync to its neighbors again and again.</em></p>
<ul>
<li>Update GCL &amp; switch forwarding rules:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./switch_config
</span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">




  <div>
    <a class="flex align-center" href="https://github.com/Mobisense/ziggo_book///tree/main//content/docs/switch/software-build/index.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="" />
      <span>编辑本页</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        <footer id="mu-footer" role="contentinfo" style="	height: 160px;
clear: both;
color: #000000;
text-align: center;
padding-top: 100px;">
    <div class="container">
        <div class="col-sm-12">
            <div>
                <p> Room 211, District 11, East Main Building, Tsinghua University, Haidian District, Beijing, China, 100084 | </p>
                <p> &copy 2021 <span class="ziggo-font">ZIGGO</span>, TNS, School of Software, Tsinghua University . All rights reserved. </p>
            </div>
        </div>
    </div>
</footer>
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  <div style="margin: 50px; display:flex; justify-content:center; gap: 25px;">
    <a href="https://github.com/MobiSense/ziggo_book" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">GitHub</a>
    <a href="https://mobisense.github.io/ziggo_homepage/" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">Home</a>
</div>

<nav id="TableOfContents">
  <ul>
    <li><a href="#build">Build</a></li>
    <li><a href="#config">Config</a></li>
    <li><a href="#run">Run</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












