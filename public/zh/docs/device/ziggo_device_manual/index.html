<!DOCTYPE html>
<html lang="zh" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="启用 CaaS 交换机的时间同步逻辑并设置TSN GCL（门控列表）、交换机转发规则（包括到双DMA）的文档。">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/zh/docs/device/ziggo_device_manual/">
  <meta property="og:site_name" content="ZIGGO BOOK">
  <meta property="og:title" content="ZIGGO Device使用手册">
  <meta property="og:description" content="启用 CaaS 交换机的时间同步逻辑并设置TSN GCL（门控列表）、交换机转发规则（包括到双DMA）的文档。">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2024-05-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-05-01T00:00:00+00:00">
    <meta property="article:tag" content="ZIGGO-Device">
    <meta property="article:tag" content="ZIGGO">
    <meta property="article:tag" content="Markdown">
    <meta property="og:image" content="http://localhost:1313/zh/docs/device/ziggo_device_manual/featured.jpg">
<title>ZIGGO Device使用手册 | ZIGGO BOOK</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="canonical" href="http://localhost:1313/zh/docs/device/ziggo_device_manual/">
  <link rel="alternate" hreflang="en" href="http://localhost:1313/docs/device/ziggo_device_manual/" title="ZIGGO Device Manual">
<link rel="stylesheet" href="/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css" integrity="sha256-MJt&#43;0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/zh.search.min.b77e601a6a6485877260bb76047048cc0366d24bc7803048aae12ec20e97c250.js" integrity="sha256-t35gGmpkhYdyYLt2BHBIzANm0kvHgDBIquEuwg6XwlA=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/zh/"><img src="/logo.png" alt="Logo" /><span>ZIGGO BOOK</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="搜索" aria-label="搜索" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>



  



  
    
  


  


<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        Chinese
      </a>
    </label>

    <ul>
      
      <li>
        <a href="http://localhost:1313/docs/device/ziggo_device_manual/">
          English
        </a>
      </li>
      
    </ul>
  </li>
</ul>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f7037f1d8c98cfd6af893e54a7a7c84a" class="toggle"  />
    <label for="section-f7037f1d8c98cfd6af893e54a7a7c84a" class="flex justify-between">
      <a href="/zh/docs/tsnperf/" class="">ZIGGO TSNPerf</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/tsnperf/principle/" class="">TSNPerf 设计原理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/tsnperf/configuration/" class="">TSNPerf 使用指南</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/tsnperf/manual/" class="">TSNPerf 检测内容及使用表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/tsnperf/report/" class="">某品牌交换机报告</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d43c4f20a039dd2c08c63c6629ffaedf" class="toggle"  />
    <label for="section-d43c4f20a039dd2c08c63c6629ffaedf" class="flex justify-between">
      <a href="/zh/docs/switch/" class="">ZIGGO Switch</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/basic_knowledge/" class="">基础知识列表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/require/" class="">准备清单</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/system-design/" class="">系统设计</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/hardware-build/" class="">Hardware Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/software-build/" class="">Software Build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/switch/contributing/" class="">How to contribute</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9944d1fadd4ce8adc7644b141d205c6b" class="toggle" checked />
    <label for="section-9944d1fadd4ce8adc7644b141d205c6b" class="flex justify-between">
      <a href="/zh/docs/device/" class="">ZIGGO Device</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/basic_knowledge/" class="">基础知识列表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/require/" class="">准备清单</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/getting-started/" class="">快速入门</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/system-design/" class="">系统设计</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/hardware-build/" class="">硬件构建</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/software-build/" class="">软件构建</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/ziggo_device_manual/" class="active">ZIGGO Device使用手册</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/cnc_manual/" class="">CNC脚本使用指南</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/testbed/" class="">TestBed搭建流程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/zh/docs/device/contributing/" class="">如何贡献</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>ZIGGO Device使用手册</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <div style="margin-top:10px; margin-bottom:40px; display:flex; justify-content:center; gap: 25px;">
    <a href="https://github.com/MobiSense/ziggo_book" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">GitHub</a>
    <a href="https://mobisense.github.io/ziggo_homepage/" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">Home</a>
</div>

<nav id="TableOfContents">
  <ul>
    <li><a href="#ziggo-device直接分析延迟和抖动">ZIGGO Device直接分析延迟和抖动</a></li>
    <li><a href="#离线分析延迟和抖动">离线分析延迟和抖动</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="ziggo-device使用手册">
  ZIGGO Device使用手册
  <a class="anchor" href="#ziggo-device%e4%bd%bf%e7%94%a8%e6%89%8b%e5%86%8c">#</a>
</h1>
<p>ZIGGO Device有两种分析方法：</p>
<blockquote>
<p>提示：如果您想使用离线分析，请切换到 &lsquo;offline_analyze&rsquo; 分支，并且需要通过网线将设备连接到另一台运行Linux的PC。</p>
</blockquote>
<p>一种方法是 <code>直接</code> 在 ZIGGO Device 上分析延迟和抖动。这种方法的优点是方便快捷。我们可以直接在设备上统计所有接收到的数据帧的延迟和抖动。然而，由于开发板 CPU 的处理能力有限，当分析大量数据包（例如每次发送超过10个1500B数据包，周期为33ms）时，可能会出现丢包现象。</p>
<p><img src="./online_analyse.png" alt="" /></p>
<p>另一种方法是使用设备对接收的数据包进行时间戳标记，并通过另一个端口转发到功能强大的台式计算机进行数据包捕获分析。即使以千兆位速率进入设备，也不会丢包。缺点是需要离线编写单独的程序来分析数据包的延迟和抖动。</p>
<p><img src="./offline_analyse.png" alt="" /></p>
<h2 id="ziggo-device直接分析延迟和抖动">
  ZIGGO Device直接分析延迟和抖动
  <a class="anchor" href="#ziggo-device%e7%9b%b4%e6%8e%a5%e5%88%86%e6%9e%90%e5%bb%b6%e8%bf%9f%e5%92%8c%e6%8a%96%e5%8a%a8">#</a>
</h2>
<p>在 <code>time sync</code> 程序运行期间，接收到测试数据帧后，程序会将数据帧的延迟信息保存在 <code>build/packet_log.csv</code> 文件中，同时将延迟和抖动的批量统计信息保存在 <code>build/critical_log.csv</code> 文件中。</p>
<p><code>packet_log.csv</code> 示例：</p>
<pre tabindex="0"><code>Seq ID, Pkt ID, TX timestamp, RX timestamp, Latency
0101, 0, 12683587446, 12683613722, 26276
0101, 1, 12683599662, 12683625970, 26308
0101, 2, 12683611862, 12683638162, 26300
0101, 3, 12683624078, 12683650386, 26308
0101, 4, 12717142039, 12717168273, 26234
0101, 5, 12717154223, 12717180465, 26242
0101, 6, 12717166391, 12717192625, 26234
0101, 7, 12717178575, 12717204825, 26250
0101, 8, 12750696471, 12750722712, 26241
0101, 9, 12750708655, 12750734904, 26249
</code></pre><p><code>critical_log.csv</code> 示例，其中延迟方差是延迟的方差：</p>
<pre tabindex="0"><code>Seq ID, Received Number, Max pkt_id, Min pkt_id, Loss Rate, Latency Mean, Latency Variance
0101, 1000, 0, 999, 0.000000,  26230, 1199
0101, 1000, 1000, 1999, 0.000000,  26218, 2811
0101, 1000, 2000, 2999, 0.000000,  26218, 2808
0101, 1000, 3000, 3999, 0.000000,  26195, 18331
0101, 1000, 4000, 4999, 0.000000,  26233, 921
0101, 1000, 5000, 5999, 0.000000,  26226, 852
0101, 1000, 6000, 6999, 0.000000,  26226, 5080
0101, 1000, 7000, 7999, 0.000000,  26250, 105272
0101, 1000, 8000, 8999, 0.000000,  26204, 7233
0101, 1000, 9000, 9999, 0.000000,  26205, 7361
</code></pre><p>您可以使用以下命令显示标题和最后5行的内容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat critical.log | head -n1
</span></span><span style="display:flex;"><span>cat critical.log | tail -n5
</span></span></code></pre></div><h2 id="离线分析延迟和抖动">
  离线分析延迟和抖动
  <a class="anchor" href="#%e7%a6%bb%e7%ba%bf%e5%88%86%e6%9e%90%e5%bb%b6%e8%bf%9f%e5%92%8c%e6%8a%96%e5%8a%a8">#</a>
</h2>
<p>如果进行离线分析，需要注意使用的硬件位于 <code>offline_analyze</code> 分支。此版本会将关键数据标记为接收时间戳，并从 ETH2 转发。我们需要使用一台装有 Linux 系统的 PC 来捕获数据包进行分析。</p>
<p>数据包捕获命令示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo tcpdump -i enx207bd272812b ether src 00:0a:35:00:00:14 -n -B <span style="color:#ae81ff">100000</span> -w packets.pcapng
</span></span></code></pre></div><p><code>Enx207bd272812b</code> 是网卡名称，可以通过 ifconfig 获取。<code>Src</code> 用于指定捕获的数据包来自某个 MAC 地址。<code>-B</code> 用于指定缓冲区大小。如果需要设置更大的缓冲区大小以避免丢包，可以查看数据包捕获后的输出信息，查看 Dropped by kernel 是否为 0。如果不是 0，则表示内核中存在丢包。<code>-W</code> 指定文件的保存路径。</p>
<p>用于分析程序的代码是 <code>analyze_packet.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python ./analyze_packet.py <span style="color:#f92672">[</span>capture file path<span style="color:#f92672">]</span> --step <span style="color:#f92672">[</span>interval<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>同时，将在当前目录生成一个数据包（<code>packet_log.csv</code> 和 <code>critical_log.csv</code>）。</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">




  <div>
    <a class="flex align-center" href="https://github.com/Mobisense/ziggo_book///tree/main//content/docs/device/ziggo_device_manual/index.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="" />
      <span>编辑本页</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        <footer id="mu-footer" role="contentinfo" style="	height: 160px;
clear: both;
color: #000000;
text-align: center;
padding-top: 100px;">
    <div class="container">
        <div class="col-sm-12">
            <div>
                <p> Room 211, District 11, East Main Building, Tsinghua University, Haidian District, Beijing, China, 100084 | </p>
                <p> &copy 2021 <span class="ziggo-font">ZIGGO</span>, TNS, School of Software, Tsinghua University . All rights reserved. </p>
            </div>
        </div>
    </div>
</footer>
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  <div style="margin-top:10px; margin-bottom:40px; display:flex; justify-content:center; gap: 25px;">
    <a href="https://github.com/MobiSense/ziggo_book" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">GitHub</a>
    <a href="https://mobisense.github.io/ziggo_homepage/" style="padding: 10px 10px;
	background-color: rgb(0, 0, 0); /* 设置按钮背景色为橙色 */
	color: white; /* 设置按钮文字颜色为白色 */
	text-decoration: none; /* 去除链接的下划线 */
	border: 3px solid rgb(0, 0, 0);
	border-radius: 5px; /* 设置按钮的边角为圆角 */
	font-size: 14px; /* 设置文字大小 */
	text-align: center; /* 按钮内文字居中显示 */
	display: inline-block; /* 使链接的布局表现为块级元素 */">Home</a>
</div>

<nav id="TableOfContents">
  <ul>
    <li><a href="#ziggo-device直接分析延迟和抖动">ZIGGO Device直接分析延迟和抖动</a></li>
    <li><a href="#离线分析延迟和抖动">离线分析延迟和抖动</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












